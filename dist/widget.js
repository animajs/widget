define("anima/widget/2.0.0/widget",["anima/base/2.0.0/base","anima/class/2.0.0/class","anima/events/1.1.0/events","anima/zepto/1.0.0/zepto","./daparser"],function(a,b,c){function d(){return"widget-"+w++}function e(a){return"[object String]"===v.call(a)}function f(a){return"[object Function]"===v.call(a)}function g(a){return!!(16&document.documentElement.compareDocumentPosition(a))}function h(a){return a.charAt(0).toUpperCase()+a.substring(1)}function i(a){return f(a.events)&&(a.events=a.events()),a.events}function j(a,b){var c=a.match(x),d=c[1]+q+b.cid,e=c[2]||void 0;return e&&e.indexOf("{{")>-1&&(e=k(e,b)),{type:d,selector:e}}function k(a,b){return a.replace(y,function(a,c){for(var d,f=c.split("."),g=b;d=f.shift();)g=g===b.attrs?b.get(d):g[d];return e(g)?g:z})}function l(a){return null==a||void 0===a}function m(a){for(var b=a.length-1;b>=0&&void 0===a[b];b--)a.pop();return a}var n=a("anima/base/2.0.0/base"),o=a("anima/zepto/1.0.0/zepto"),p=a("./daparser"),q=".delegate-events-",r="_onRender",s="data-widget-cid",t={},u=n.extend({propsInAttrs:["initElement","element","events"],element:null,events:null,attrs:{id:null,className:null,style:null,template:"<div></div>",model:null,parentNode:document.body},initialize:function(a){this.cid=d();var b=this._parseDataAttrsConfig(a);u.superclass.initialize.call(this,a?o.extend(b||{},a):b),this.parseElement(),this.initProps(),this.delegateEvents(),this.setup(),this._stamp(),this._isTemplate=!(a&&a.element)},_parseDataAttrsConfig:function(a){var b,c;return a&&(b=a.initElement?o(a.initElement):o(a.element)),b&&b[0]&&(c=p.parseElement(b)),c},parseElement:function(){var a=this.element;if(a?this.element=o(a):this.get("template")&&(this.element=o(this.get("template"))),!this.element||!this.element[0])throw new Error("element is invalid")},initProps:function(){},delegateEvents:function(a,b,c){var d=m(Array.prototype.slice.call(arguments));if(0===d.length?(b=i(this),a=this.element):1===d.length?(b=a,a=this.element):2===d.length?(c=b,b=a,a=this.element):(a||(a=this.element),this._delegateElements||(this._delegateElements=[]),this._delegateElements.push(o(a))),e(b)&&f(c)){var g={};g[b]=c,b=g}for(var h in b)if(b.hasOwnProperty(h)){var k=j(h,this),l=k.type,n=k.selector;!function(b,c){var d=function(a){f(b)?b.call(c,a):c[b](a)};o(a).on(l,n,d)}(b[h],this)}return this},undelegateEvents:function(a,b){var c=m(Array.prototype.slice.call(arguments));if(b||(b=a,a=null),0===c.length){var d=q+this.cid;if(this.element&&this.element.off(d),this._delegateElements)for(var e in this._delegateElements)this._delegateElements.hasOwnProperty(e)&&this._delegateElements[e].off(d)}else{var f=j(b,this);a?o(a).off(f.type,f.selector):this.element&&this.element.off(f.type,f.selector)}return this},setup:function(){},render:function(){this.rendered||(this._renderAndBindAttrs(),this.rendered=!0);var a=this.get("parentNode");return a&&!g(this.element[0])&&this.element.appendTo(a),this},_renderAndBindAttrs:function(){var a=this,b=a.attrs;for(var c in b)if(b.hasOwnProperty(c)){var d=r+h(c);if(this[d]){var e=this.get(c);l(e)||this[d](e,void 0,c),function(b){a.on("change:"+c,function(c,d,e){a[b](c,d,e)})}(d)}}},_onRenderId:function(a){this.element.attr("id",a)},_onRenderClassName:function(a){this.element.addClass(this.element,a)},_onRenderStyle:function(a){this.element.css(a)},_stamp:function(){var a=this.cid;(this.initElement||this.element).attr(s,a),t[a]=this},$:function(a){return this.element.find(a)},destroy:function(){this.undelegateEvents(),delete t[this.cid],this.element&&this._isTemplate&&(this.element.off(),this.element.remove()),this.element=null,u.superclass.destroy.call(this)}});o(window).unload(function(){for(var a in t)t[a].destroy()}),c.exports=u;var v=Object.prototype.toString,w=0,x=/^(\S+)\s*(.*)$/,y=/{{([^}]+)}}/g,z="INVALID_SELECTOR"}),define("anima/widget/2.0.0/daparser",[],function(a,b){function c(a){return a.toLowerCase().replace(g,function(a,b){return(b+"").toUpperCase()})}function d(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if("string"!=typeof c)continue;h.test(c)?(c=c.replace(/'/g,'"'),a[b]=d(i(c))):a[b]=e(c)}return a}function e(a){if("false"===a.toLowerCase())a=!1;else if("true"===a.toLowerCase())a=!0;else if(/\d/.test(a)&&/[^a-z]/i.test(a)){var b=parseFloat(a);b+""===a&&(a=b)}return a}function f(a,b){for(var c in b)a[c]=b[c];return a}b.parseElement=function(a,b){var e={};if(a[0]&&(a=a[0]),a.dataset)e=f({},a.dataset);else for(var g=a.attributes,h=0,i=g.length;i>h;h++){var j=g[h],k=j.name;0===k.indexOf("data-")&&(k=c(k.substring(5)),e[k]=j.value)}return b===!0?e:d(e)};var g=/-([a-z])/g,h=/^\s*[\[{].*[\]}]\s*$/,i=JSON.parse});
